#!/bin/bash

p_value_file=~/.p_values.txt
p_key_file=~/.p_keys.txt
p_values=()
p_keys=()

function p_load_file(){
  p_values=()
  p_keys=()
  valueNum=-1
  keyNum=-1
  if [ -f $p_value_file ];then
    while read line
    do
      let valueNum+=1
      p_values[$valueNum]="$line"
    done < $p_value_file
  
    while read line
    do 
      let keyNum+=1
      p_keys[$keyNum]="$line"
    done < $p_key_file
  fi
}
# 初始化需要读取本地文件
p_load_file

function p_save_file(){
  valueText=""
  keyText=""
  if [ -f $p_value_file ];then
    rm -rf $p_value_file $p_key_file
  fi
  len=${#p_keys[@]}
  for((i=0;i<$len;i++));do
    key=${p_keys[$i]}
    value=${p_values[$i]}
    echo "$value" >> $p_value_file
    echo "$key" >> $p_key_file
  done
}

function pc(){
  p_load_file
  len=${#p_keys[@]}
  for((i=0;i<$len;i++));do
    key=${p_keys[$i]}
    value=${p_values[$i]}
    if [ "$1" == "$key" ]; then
      cd $value
    fi
  done
}
function pa(){
  if [ "$1" == "" ];then
    pl
    echo "please input name"
  else
    p_load_file
    ishave="0"
    len=${#p_keys[@]}
    for((i=0;i<$len;i++));do
      key=${p_keys[$i]}
      value=${p_values[$i]}
      if [ "$1" == "$key" ]; then
        ishave="1"
        echo "[p-add] $1 is saved in dir: $i"
      fi
    done

    if [ "$ishave" == "0" ];then
      len=${#p_keys[@]}
      p_keys[$len]=$1
      p_values[$len]=`pwd`
      echo "[$len] [${p_keys[$len]}] ${p_values[$len]}"
      p_save_file
    fi
  fi
}
function p-clear(){
  p_values=()
  p_keys=()
  p_save_file
  echo "[p-init] did empty"
}
function pd(){
  newKeys=()
  newValues=()
  nowNum=-1
  len=${#p_keys[@]}
  for((i=0;i<$len;i++));do
    key=${p_keys[$i]}
    value=${p_values[$i]}
    if [ "$1" == "$key" -o "$1" == "$i" ]; then
      echo "delete: [$i] [$key] $value"
    else
      let nowNum+=1
      newValues[$nowNum]=$value
      newKeys[$nowNum]=$key
    fi
  done
  # clear old data
  p_values=()
  p_keys=()
  # add deleted data
  len=${#newKeys[@]}
  for((i=0;i<$len;i++));do
    p_values[$i]=${newValues[$i]}
    p_keys[$i]=${newKeys[$i]}
  done
  p_save_file
}
function pl(){
  p_load_file
  len=${#p_keys[@]}
  if [ $len == 0 ];then
    echo "[p-ls] is empty"
  fi
  for((i=0;i<$len;i++));do
    key=${p_keys[$i]}
    value=${p_values[$i]}
    echo [$i] [$key] $value
  done
}